<!DOCTYPE html>
<html lang="en">
  <!-- Force a light color scheme even when the OS/browser prefers dark -->
  <meta name="color-scheme" content="light">
  <style id="ics309-hardlight">
    :root { color-scheme: light; }
    html, body { background:#fff !important; color:#000 !important; }
    /* Nuke any inversion/filters some extensions inject */
    html { filter:none !important; }
    /* Tables/boxes: black text, white cells, visible borders */
    table, th, td { background:#fff !important; color:#000 !important; border-color:#000 !important; }
    th { font-weight: 600; }
    /* Keep it readable if browser says prefers dark anyway */
    @media (prefers-color-scheme: dark) {
      html, body { background:#fff !important; color:#000 !important; }
    }
    @media print {
      /* Print exactly as on screen (donâ€™t fade colors) */
      * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      #ics-controls { display:none !important; }
    }
  </style>
<meta charset="utf-8">
<title>ICS-309 Communications Log</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root { --ink:#333; --line:#333; --head:#e9eafe; }
  html,body{margin:0;padding:0;background:#fff;color:var(--ink);font:13px/1.35 Arial,Helvetica,sans-serif;}
  .sheet{width:8.5in;margin:0 auto;padding:.25in;box-sizing:border-box;}
  h1{margin:0 0 .25rem 0;text-align:center;font-size:1.25rem;}
  .box{border:1px solid var(--line);padding:.25rem .35rem;}
  .label{font-size:.78rem;color:#333;margin-bottom:.15rem;}
  .row{display:grid;grid-template-columns:2fr 2fr 2fr 2fr;gap:.15rem;}
  .subrow{display:grid;grid-template-columns:1fr 1fr;gap:.15rem;}
  table{width:100%;border-collapse:collapse;margin-top:.15rem;}
  thead th{border:1px solid var(--line);padding:.25rem;background:var(--head);font-weight:600;}
  tbody td{border:1px solid var(--line);padding:.25rem;vertical-align:top;min-height:1rem;}
  .tiny{font-size:.75rem;}
  .footer{display:grid;grid-template-columns:3fr 2fr;gap:.15rem;margin-top:.25rem;}
  @media print{
    @page{size:letter portrait;margin:.5in;}
    thead{display:table-header-group;}
  }
</style>
<body>
  {% if show_controls %}
  <div id="ics-controls" style="position:sticky; top:0; z-index:10; background:#fff; border-bottom:1px solid #ccc; padding:.5rem .75rem; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif; display:flex; gap:.75rem; align-items:center;">
    <a href="{{ url_for('exports.comms_ics309_download') }}{% if request.query_string %}?{{ request.query_string.decode('utf-8') }}{% endif %}">
      Download single-file HTML
    </a>
    <button type="button" onclick="window.print()" style="padding:.4rem .8rem; border:1px solid #999; border-radius:.4rem; background:#f5f5f5; cursor:pointer;">
      Print
    </button>
    <span style="margin-left:auto; font-size:.85rem; color:#222;">Times shown in UTC</span>
  </div>
  {% endif %}

<div class="sheet">
  <h1>Communications Log (ICS 309)</h1>

  <div class="row" style="margin-bottom:.15rem;">
    <div class="box">
      <div class="label">1. INCIDENT NAME</div>
      <div>{{ incident_name_display }}</div>
    </div>
    <div class="box">
      <div class="label">2. OPERATIONAL PERIOD</div>
      <div class="subrow">
        <div>From: {{ op_from_date }}&nbsp;&nbsp;Time {{ op_from_time }}</div>
        <div>To: {{ op_to_date }}&nbsp;&nbsp;Time {{ op_to_time }}</div>
      </div>
    </div>
    <div class="box">
      <div class="label">3. RADIO NETWORK NAME</div>
      <div>{{ radio_network_name }}</div>
    </div>
    <div class="box">
      <div class="label">4. RADIO OPERATOR (Name, Call Sign)</div>
      <div>{{ radio_operator }}</div>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th style="width:10%;">Time<br><span class="tiny">(24:00)</span></th>
        <th style="width:20%;">FROM<br><span class="tiny">Call Sign/ID &nbsp;|&nbsp; Msg #</span></th>
        <th style="width:20%;">TO<br><span class="tiny">Call Sign/ID &nbsp;|&nbsp; Msg #</span></th>
        <th>Message</th>
      </tr>
    </thead>
    <tbody>
      {% for r in rows %}
      <tr>
        <td>{{ r.time_utc }}</td>
        <td>{{ r.from_id }}{% if r.from_msg_no %} &nbsp;|&nbsp; {{ r.from_msg_no }}{% endif %}</td>
        <td>{{ r.to_id }}{% if r.to_msg_no %} &nbsp;|&nbsp; {{ r.to_msg_no }}{% endif %}</td>
        <td>{{ r.message }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="footer">
    <div class="box"><div class="label">6. PREPARED BY (Name, Position)</div>{{ prepared_by }}</div>
    <div class="box"><div class="label">7. DATE &amp; TIME PREPARED</div>{{ prepared_dt }}</div>
  </div>
</div>
</body>
</html>
