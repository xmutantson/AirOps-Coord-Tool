{# templates/wargame_choose_role.html #}
{% extends 'base.html' %}
{% block content %}
<div class="container">
  <h1>Wargame Mode – Select Your Role</h1>
  <form method="post" action="{{ url_for('wargame_choose_role') }}">
    <fieldset>
      <legend>Choose one:</legend>

      <label>
        <input type="radio" name="role" value="radio" required
               {% if session.get('wargame_role')=='radio' %}checked{% endif %}>
        Radio Operator
      </label>
      <p class="hint">Handle incoming Winlink‑style messages.</p>

      <label>
        <input type="radio" name="role" value="ramp"
               {% if session.get('wargame_role')=='ramp' %}checked{% endif %}>
        Ramp Boss
      </label>
      <p class="hint">Manage arrivals &amp; departure paperwork.</p>

      <label>
        <input type="radio" name="role" value="inventory"
               {% if session.get('wargame_role')=='inventory' %}checked{% endif %}>
        Inventory Specialist
      </label>
      <p class="hint">Process supply requests &amp; deliveries.</p>

      <label>
        <input type="radio" name="role" value="super"
               {% if session.get('wargame_role')=='super' %}checked{% endif %}>
        Exercise Supervisor
      </label>
      <p class="hint">View real‑time metrics &amp; settings.</p>

      <div id="super-settings" style="display:none; margin-top:1rem;">
        <h3>Supervisor Settings</h3>

        <label>
          Radio msgs/hr:
          <input type="number"
                 name="radio_rate"
                 min="0"
                 value="{{ settings.get('radio_rate', 12) }}">
        </label>

        <label>
          Use 5 min batch queue for inbound flights:
          <input type="checkbox"
                 name="radio_use_batch"
                 value="yes"
                 {% if settings.get('radio_use_batch','yes')=='yes' %}checked{% endif %}>
        </label>

        <label>
          Include batch delay in radio‑operator metrics:
          <input type="checkbox"
                 name="radio_count_batch"
                 value="yes"
                 {% if settings.get('radio_count_batch','yes')=='yes' %}checked{% endif %}>
        </label>

        <label>
          Inventory req/hr:
          <input type="number"
                 name="inv_rate"
                 min="0"
                 value="{{ settings.get('inv_rate', 6) }}">
        </label>

        <label>
          Ramp flights/hr:
          <input type="number"
                 name="ramp_rate"
                 min="0"
                 value="{{ settings.get('ramp_rate', 10) }}">
        </label>

        <label>
          Balance ±% inbound/outbound:
          <input type="number"
                 name="balance_pct"
                 min="0"
                 max="100"
                 value="{{ settings.get('balance_pct', 20) }}">
        </label>
        <hr class="separator">
        <h4>Max Pending (queue caps)</h4>
        <label>
          Radio inbox (visible messages):
          <input type="number"
                 name="max_radio"
                 min="1"
                 value="{{ settings.get('max_radio', 3) }}">
        </label>
        <label>
          Ramp cue cards (inbound flights waiting):
          <input type="number"
                 name="max_ramp"
                 min="1"
                 value="{{ settings.get('max_ramp', 3) }}">
        </label>
        <label>
          Inventory requests (pending “out” lines):
          <input type="number"
                 name="max_inventory"
                 min="1"
                 value="{{ settings.get('max_inventory', 3) }}">
        </label>
      </div>

      <button type="submit" class="btn">Confirm Role</button>
    </fieldset>
  </form>
</div>

<script>
  // Show/hide the supervisor panel
  const radios = document.querySelectorAll('input[name="role"]');
  const panel  = document.getElementById('super-settings');
  radios.forEach(r => r.addEventListener('change', () => {
    panel.style.display = document.querySelector('input[value="super"]:checked')
                          ? 'block'
                          : 'none';
  }));
  // On page‐load, if “super” was already selected, show panel:
  if (document.querySelector('input[value="super"]:checked')) {
    panel.style.display = 'block';
  }
</script>
{% endblock %}
