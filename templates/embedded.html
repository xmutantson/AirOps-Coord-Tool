{% extends "base.html" %}
{% block title %}{{ embedded_name }} â€“ Aircraft Ops{% endblock %}

{% block content %}
<style>
  /* full-page reset */
  html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }

  /* pin container between header & footer */
  body.embedded main.container {
    position: absolute;
    top: 3.5rem;    /* height of header */
    bottom: 2.5rem; /* height of footer */
    left: 0;
    right: 0;
    margin: 0;
    padding: 0;
  }

  /* scoped iframe styling */
  #tar1090-frame {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border: none;
    touch-action: none;
    overscroll-behavior: contain;
    -webkit-overflow-scrolling: touch;
  }
</style>

<main class="container">
  <iframe id="tar1090-frame" src="{{ url }}"></iframe>
</main>

<script>
  const iframe = document.getElementById('tar1090-frame');
  iframe.addEventListener('load', () => {
    try {
      // only target real tar1090 embeds
      if (!iframe.src.includes('/tar1090/')) {
        console.warn('Skipping tar1090 injection: URL mismatch');
        return;
      }
      const childWin = iframe.contentWindow;
      const map = childWin.map;
      if (!map || typeof map.invalidateSize !== 'function') {
        console.warn('tar1090 `map` not found for injection');
        return;
      }

      // on touch end: load missing tiles
      map.on('touchend', () => map.invalidateSize({ pan: false }));

      // on resize/orientation change: redraw map
      window.addEventListener('resize', () => map.invalidateSize({ animate: true }));

      console.log('Injected tar1090 resize/touchend handlers');
    } catch (err) {
      console.error('Injection into tar1090 iframe failed:', err);
    }
  });
</script>
{% endblock %}
