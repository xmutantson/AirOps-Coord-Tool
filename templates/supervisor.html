{% extends "base.html" %}
{% block content %}
<div class="supervisor-dashboard" style="margin-top:1rem; height: calc(100vh - 6rem);">
  <div id="supervisor-counts" class="supervisor-panel">
    <!-- small tool links bar (top-left tile) -->
    <div class="panel-toolbar" style="display:flex; gap:.5rem; flex-wrap:wrap; align-items:center; margin-bottom:.5rem;">
      <a href="{{ url_for('staff.staff_list') }}" class="button small" style="padding:.25rem .5rem; border:1px solid #ccc; border-radius:.4rem; text-decoration:none; font-size:.9rem;">
        Staff
      </a>
      <a href="{{ url_for('comms.comms_index') }}" class="button small" style="padding:.25rem .5rem; border:1px solid #ccc; border-radius:.4rem; text-decoration:none; font-size:.9rem;">
        Communications Log
      </a>
    </div>
    <div id="supervisor-counts-body"><!-- counts load here --></div>
  </div>
  <div id="supervisor-map" class="supervisor-panel">
    {% if embedded_url %}
      <iframe src="{{ embedded_url }}"
              style="width:100%; height:100%; border:1px solid #ccc;"></iframe>
    {% else %}
      <div class="muted" style="padding:1rem; text-align:center;">
        No ADS-B map configured
      </div>
    {% endif %}
  </div>
  <div id="inventory-table" class="supervisor-panel"><!-- inventory overview --></div>
  <div id="supervisor-recent-flights" class="supervisor-panel">
    <h3 style="text-align:center; margin-top:0; margin-bottom:1rem;">Priority Flights</h3>
    <!-- recent flights table will be injected here -->
  </div>
</div>

<script>
  async function loadSupervisorCounts(){
    const resp = await fetch("{{ url_for('supervisor.supervisor_counts_partial') }}");
    document.getElementById("supervisor-counts-body").innerHTML = await resp.text();
  }
  async function loadSupervisorRecent(){
    const resp = await fetch("{{ url_for('supervisor.supervisor_recent_flights_partial') }}");
    document.getElementById("supervisor-recent-flights").innerHTML = await resp.text();
  }
  async function loadInventoryOverview(){
    const resp = await fetch("{{ url_for('inventory.inventory_overview_table') }}");
    document.getElementById("inventory-table").innerHTML = await resp.text();
  }
  // initial + auto-refresh
  loadSupervisorCounts();
  loadSupervisorRecent();
  loadInventoryOverview();
  setInterval(loadSupervisorCounts, 30000);
  setInterval(loadSupervisorRecent, 30000);
  setInterval(loadInventoryOverview, 60000);
</script>
{% endblock %}
